<!DOCTYPE html>
<html>
  <head>
    <script src="jquery.js"></script>
    <script src="data_generator.js"></script>
    <link rel="stylesheet" type="text/css" href="stylesheet.css">
  </head>
  <body>
    <div id='header'>
      <img height='70px' src="assets/birdlogo.png" />
    </div>
    <div id='container'>
      <div id='tweeting'>
      <textarea id="tweet_box" cols='58' rows='1' placeholder="What's happening?"></textarea>
      <a href='#' id='post'>Twittle</a>
      </div>
      <div id="content">
        <button type="button" id='refresh'>Refresh All Tweets</button>
        <div id="tweets"></div>
      </div>
    </div>
    <script>

    $(document).ready(function(){
      var $body = $('body');
      //$body.html('');

      var howLongAgo = function(tweetTime) {
            var timeNow = new Date();
            var timeDifference = Math.floor(((timeNow - tweetTime)/60000));
            if (timeDifference > 60) {
              var diffInHours = timeDifference/60;
              var numOfHours = Math.floor(diffInHours);
              var numOfMin = Math.floor((diffInHours - numOfHours) * 60);
              var minOrHoursAgo = '- ' + numOfHours + ' hr' + (numOfHours > 1 ? 's ' : ' ') + numOfMin + ' min' + (numOfMin > 1 ? 's ' : ' ') + 'ago';
            } else if (timeDifference >= 1){
              minOrHoursAgo = '- ' + timeDifference + ' min' + (timeDifference > 1 ? 's ' : ' ') + 'ago';
            } else {
              minOrHoursAgo = '- just now';
            }
            return ' ' +  minOrHoursAgo;
          };

      var showTweets = function(tweetArray) {
        $('#tweets').empty();
        var index = tweetArray.length - 1;

        while(index >= 0){
          var tweet = tweetArray[index];
          var $tweet = $('<div></div>');

          $tweet.html('@<a href="#" class="' + tweet.user +'">' + tweet.user + '</a>: ' + tweet.message + howLongAgo(tweet.created_at));
          $tweet.appendTo($('#tweets'));
          index -= 1;
        }

        // when clickingo on a username only show that user's tweets
        $('#tweets a').on('click', function() {
          var whatClass = $(this).attr('class');
          showTweets(streams.users[whatClass]);
          $('#refresh').text('Show All Tweets');
        })
      };

      showTweets(streams.home);

      $('#refresh').on('click', function() {
        showTweets(streams.home);
        $('#refresh').text('Refresh Tweets');
      });
      
      $('#post').on('click', function() {
        var tweet = $('#tweet_box').val();
        if (tweet) {
          writeTweet(tweet);
          showTweets(streams.home);
          $('#tweet_box').val('');
        }
      });

      $('#tweet_box').on('click', function() {
        $(this).attr('rows', 4);
      });

      $('#tweet_box').focusout(function() {
        $(this).attr('rows', 1);
      })
});

    </script>
  </body>
</html>
