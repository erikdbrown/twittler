<!DOCTYPE html>
<html>
  <head>
    <script src="jquery.js"></script>
    <script src="data_generator.js"></script>
    <link rel="stylesheet" type="text/css" href="stylesheet.css">
  </head>
  <body>
    <button type="button" id='refresh'>Refresh All Tweets</button>
    <textarea id="tweet_box" cols='58' rows='4' placeholder="What's happening?"></textarea>
    <button type='button' id='post'>Post Tweet</button>
    <div id="tweets"></div>
    <script>

    $(document).ready(function(){
      var $body = $('body');
      //$body.html('');

      var howLongAgo = function(tweetTime) {
            var timeNow = new Date();
            var timeDifference = Math.floor(((timeNow - tweetTime)/60000));
            if (timeDifference > 60) {
              var diffInHours = timeDifference/60;
              var numOfHours = Math.floor(diffInHours);
              var numOfMin = Math.floor((diffInHours - numOfHours) * 60);
              var minOrHoursAgo = '- ' + numOfHours + ' hr' + (numOfHours > 1 ? 's ' : ' ') + numOfMin + ' min' + (numOfMin > 1 ? 's ' : ' ') + 'ago';
            } else if (timeDifference >= 1){
              minOrHoursAgo = '- ' + timeDifference + ' min' + (timeDifference > 1 ? 's ' : ' ') + 'ago';
            } else {
              minOrHoursAgo = '- just now';
            }
            return ' ' +  minOrHoursAgo;
          };

      var showTweets = function(tweetArray) {
        $('#tweets').empty();
        var index = tweetArray.length - 1;

        while(index >= 0){
          var tweet = tweetArray[index];
          var $tweet = $('<div></div>');

          $tweet.html('@<a href="#" class="' + tweet.user +'">' + tweet.user + '</a>: ' + tweet.message + howLongAgo(tweet.created_at));
          $tweet.appendTo($('#tweets'));
          index -= 1;
        }

        // when clickingo on a username only show that user's tweets
        $('a').on('click', function() {
          var whatClass = $(this).attr('class');
          showTweets(streams.users[whatClass]);
          $('#refresh').text('Show All Tweets');
        })
      };

      showTweets(streams.home);

      $('#refresh').on('click', function() {
        showTweets(streams.home);
        $('#refresh').text('Refresh Tweets');
      });
      
      $('#post').on('click', function() {
        writeTweet($('#tweet_box').val());
        showTweets(streams.home);
      });
});

    </script>
  </body>
</html>
