<!DOCTYPE html>
<html>
  <head>
    <script src="jquery.js"></script>
    <script src="data_generator.js"></script>
  </head>
  <body>
    <button type="button" id='refresh'>Refresh Tweets</button>
    <textarea id="tweet_box" cols='58' rows='4' placeholder="What's happening?"></textarea>
    <button type='button' id='post'>Post Tweet</button>
    <div id="tweets"></div>
    <script>

    $(document).ready(function(){
      var $body = $('body');
      //$body.html('');

      var refresh = function() {
        var timeNow = new Date();
        $('#tweets').empty();
        var index = streams.home.length - 1;

        while(index >= 0){
          var tweet = streams.home[index];
          var $tweet = $('<div></div>');

          var howLongAgo = function(tweetTime) {
            var timeDifference = Math.floor(((timeNow - tweetTime)/60000));
            if (timeDifference > 60) {
              var diffInHours = timeDifference/60;
              var numOfHours = Math.floor(diffInHours);
              var numOfMin = Math.floor((diffInHours - numOfHours) * 60);
              var minOrHoursAgo = '- ' + numOfHours + ' hr' + (numOfHours > 1 ? 's ' : ' ') + numOfMin + ' min' + (numOfMin > 1 ? 's ' : ' ') + 'ago';
            } else if (timeDifference >= 1){
              minOrHoursAgo = '- ' + timeDifference + ' min' + (timeDifference > 1 ? 's ' : ' ') + 'ago';
            } else {
              minOrHoursAgo = '- just now';
            }
            return ' ' +  minOrHoursAgo;
          }

          $tweet.html('@<a href="#" class="' + tweet.user +'">' + tweet.user + '</a>: ' + tweet.message + howLongAgo(tweet.created_at));
          $tweet.appendTo($('#tweets'));
          index -= 1;
        }

        $('a').on('click', function() {
          var whatClass = $(this).attr('class');
          console.log(this);
          console.log(whatClass);
        })
      };

      $('#refresh').on('click', refresh);
      
      $('#post').on('click', function() {
        writeTweet($('#tweet_box').val());
        refresh();
      });
});

    </script>
  </body>
</html>
